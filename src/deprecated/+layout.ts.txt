import type { LayoutLoad } from './$types';
import { supabase } from '../../supabaseClient';
import type { AuthSession } from '@supabase/supabase-js';

export const load: LayoutLoad = async () => {
    const { data } = await supabase.auth.getSession();
    return { session: data.session };
    if (data.session) {
        return { session: data.session };
    } else {
        console.log('No session found!');
        window.location.href = '/';
    }
};

	/*
	let session: AuthSession | null = $state(null);
	let userProfile: Profile | null = $state(null);

	onMount(() => {
		supabase.auth.getSession().then(async ({ data }) => {
			session = data.session;
			console.log(session);
			if (session == null) {
				window.location.href = '../';
			}
			// Set profile data
			userProfile = (await getProfile(session)) as Profile | null;
			updateGlobalTables(userProfile?.language as TranslationLanguage);
		});

		supabase.auth.onAuthStateChange((_event, _session) => {
			session = _session;
			if (session == null) {
				window.location.href = '../';
			}
		});
	});
	*/